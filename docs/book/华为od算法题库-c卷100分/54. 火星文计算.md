# 54. 火星文计算
![54](/images/od/54.png)
![54-1](/images/od/54-1.png)

```js
const readline = require('readline');
const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
});
rl.on('line', function(line) {
    console.log(operate(line));
});
function operate(str) {
    const stack = [];
    let i = 0;
    while(i < str.length) {
        if (/\d/.test(str[i])) {
            const start = i;
            while(i < str.length && /\d/.test(str[i])) {
                i++;
            }
            const num = parseInt(str.substring(start, i));
            stack.push(num);
        } else {
            if (str[i] === '$') {
                const y = stack.pop();
                i++;
                const start = i;
                while(i<str.length && /\d/.test(str[i])) {
                    i++;
                }
                const x = parseInt(str.substring(start, i));
                stack.push(3*y + x + 2);
            } else if (str[i] === '#') {
                i++;
            }
        }
    }
    const reverse = [];
    while(stack.length > 0) {
        reverse.push(stack.pop());
    }
    let result = reverse.pop();
    while(reverse.length > 0) {
        const x = reverse.pop();
        result = 2*result + 3*x + 4;
    }
    return result;
}
```

