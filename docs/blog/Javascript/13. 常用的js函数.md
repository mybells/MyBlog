# 13. 常用的js函数

[[toc]]

### 浅拷贝
```js
function extend (a, b) {
  for (const key in b) {
    a[key] = b[key]
  }
  return a
}
```

### 深拷贝
```js
function clone (value) {
  if (Array.isArray(value)) {
    return value.map(clone)
  } else if (value && typeof value === 'object') {
    const res = {}
    for (const key in value) {
      res[key] = clone(value[key])
    }
    return res
  } else {
    return value
  }
}
```

### 判断对象是否相等
```js
function isObjectEqual (a = {}, b = {}): boolean {
  // handle null value #1566
  if (!a || !b) return a === b
  const aKeys = Object.keys(a)
  const bKeys = Object.keys(b)
  if (aKeys.length !== bKeys.length) {
    return false
  }
  return aKeys.every(key => {
    const aVal = a[key]
    const bVal = b[key]
    // check nested equality
    if (typeof aVal === 'object' && typeof bVal === 'object') {
      return isObjectEqual(aVal, bVal)
    }
    return String(aVal) === String(bVal)
  })
}
```

### 异步执行
```js
function runQueue (queue: Array, fn: Function, cb: Function) {
  const step = index => {
    if (index >= queue.length) {
      cb()
    } else {
      if (queue[index]) {
        fn(queue[index], () => {
          step(index + 1)
        })
      } else {
        step(index + 1)
      }
    }
  }
  step(0)
}
```
测试：
```js
const calls = []
const queue = [1, 2, 3, 4, 5].map(i => next => {
  calls.push(i)
  console.log(i);
  setTimeout(next, 2000)
})
runQueue(queue, (fn, next) => fn(next), () => {
  console.log(calls)
})

// 15:59:12.079 1
// 15:59:14.067 2
// 15:59:16.071 3
// 15:59:18.073 4
// 15:59:20.077 5
// 15:59:22.079 [1, 2, 3, 4, 5]
```

## 重写window.Date,和服务器时间一致
```js
$axios.get('/getServerDate').then(res => {
  let serverDate = new Date(res.headers.date);
  let difference = serverDate - new Date();
  let temp = window.Date;
  window.Date = function() {
    if (arguments.length) {
      return new temp(...arguments);
    } else {
      return new temp(difference + new temp().getTime());
    }
  }
  window.Date.prototype = temp.prototype;
  window.Date.parse = temp.parse;
  window.Date.now = function() {
    return Date().getTime();
  };
})
```

## 节流
```js
const throttle = (fn, delay) => {
  let flag = true;
  return (...args) => {
    if (!flag) return;
    flag = false;
    setTimeout(() => {
      fn.apply(this, args);
      flag = true;
    }, delay);
  }
}

```

## 防抖
```js
const debounce = (fn, delay) => {
  let timer = null;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => {
      fn.apply(this, args);
    }, delay);
  }
}

```

## 遍历二叉树
```js
function lvl(root) {
  let res = [];
  const dep = (node, level) => {
    if (!node) return;
    res[level] ? res[level].push(node.val) : res[level] = [node.val];
    level++;
    dep(node.left, level);
    dep(node.right, level);
  }
  dep(root, 0);
  return res;
}
```

## Promise.all
```js
Promise.all = function(arr) {
  return new Promise((resolve, reject) => {
    let ans = [];
    let count = 0;
    for(let i=0; i<arr.length; i++) {
      arr[i].then(val => {
        ans[i] = val;
        count++;
        if (count === arr.length) {
          resolve(ans);
        }
      }, err => {
        reject(err)
      })
    }
  });
}

```

## Promise.allSettled
```js
Promise.allSettled = function(arr) {
  return new Promise((resolve, reject) => {
    let ans = [];
    let count = 0;
    for(let i=0; i<arr.length; i++) {
      arr[i].then(val => {
        ans[i] = { status: 'fulfilled', value: val };
      }, err => {
        ans[i] = { status: 'rejected', reason: err };
      }).finally(() => {
        count++;
        if (count === arr.length) {
          resolve(ans);
        }
      });
    }
  });
}

```

### 冒泡排序
```js
for(let i=1; i<arr.length; i++) {
  for(let j=0; j<arr.length-i; j++) {
    if (arr[j] > arr[j+1]) {
      [arr[j], arr[j+1]] = [arr[j+1], arr[j]];
    }
  }
}
```

### 选择排序
```js
for(let i=0; i<arr.length; i++) {
  let minIndex = i;
  for(let j=i+1; j<arr.length; j++) {
    if (arr[minIndex] > arr[j]) {
      minIndex = j;
    }
  }
  [arr[minIndex], arr[j]] = [arr[j], arr[minIndex]];
}
```


### 插入排序
### 快速排序